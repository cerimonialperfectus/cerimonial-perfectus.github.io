import{u as b,r as n,j as e}from"./index-FEUtmEKI.js";import{a as C}from"./index-xsH4HHeE.js";import{C as j,B as P,T as w,a as I,b as T}from"./TextField-BXXwOkAV.js";import{P as E,T as k,A as S,C as A}from"./List-BNTYkXwl.js";import"./Transition-CllzQJyI.js";import"./TransitionGroupContext-QBMk-fzG.js";const L=localStorage.getItem("userId"),z="http://localhost:3000",D=`${z}/users/${L}`;function $(){const h=b(),[i,f]=n.useState(""),[d,m]=n.useState(""),[t,p]=n.useState(!1),[r,g]=n.useState(null),[l,s]=n.useState({open:!1,message:"",severity:"info"}),v=(a,c)=>{c!=="clickaway"&&s({...l,open:!1})},y=async a=>{var c,x;if(a.preventDefault(),g(null),!i.trim()||!d.trim()){s({open:!0,message:"Por favor, preencha ambos os campos de senha.",severity:"error"});return}if(i!==d){s({open:!0,message:"As senhas não coincidem. Tente novamente.",severity:"error"}),m("");return}p(!0);try{const o=localStorage.getItem("userId"),u=localStorage.getItem("token");if(!o||!u){s({open:!0,message:"Erro de autenticação. Por favor, faça login novamente.",severity:"error"}),p(!1),h("/Login");return}await C.put(D,{password:i},{headers:{userId:o,Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}),s({open:!0,message:"Senha atualizada com sucesso! Você será redirecionado.",severity:"success"}),f(""),m(""),setTimeout(()=>{h("/Dashboard")},2500)}catch(o){console.error("Failed to reset password:",o);const u=((x=(c=o.response)==null?void 0:c.data)==null?void 0:x.message)||o.message||"Não foi possível atualizar a senha. Tente novamente.";s({open:!0,message:`Erro: ${u}`,severity:"error"})}finally{p(!1)}};return e.jsxs(j,{component:"main",maxWidth:"xs",sx:{mt:8,mb:4},children:[e.jsxs(E,{elevation:3,sx:{padding:{xs:2,sm:4},display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(k,{component:"h1",variant:"h5",sx:{mb:3},children:"Alterar Senha"}),r&&!t&&e.jsx(S,{severity:"error",sx:{mb:2,width:"100%"},onClose:()=>g(null),children:r}),e.jsxs(P,{component:"form",onSubmit:y,noValidate:!0,sx:{mt:1,width:"100%"},children:[e.jsx(w,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Nova Senha",type:"password",id:"password",autoComplete:"new-password",value:i,onChange:a=>f(a.target.value),disabled:t,autoFocus:!0,error:!!(r&&r.toLowerCase().includes("senha"))}),e.jsx(w,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirmar Nova Senha",type:"password",id:"confirmPassword",autoComplete:"new-password",value:d,onChange:a=>m(a.target.value),disabled:t,error:!!(r&&r.toLowerCase().includes("senha"))}),e.jsx(I,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",sx:{mt:3,mb:2,py:1.5},disabled:t,children:t?e.jsx(A,{size:24,color:"inherit"}):"Salvar Nova Senha"})]})]}),e.jsx(T,{open:l.open,autoHideDuration:6e3,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(S,{onClose:v,severity:l.severity,sx:{width:"100%"},variant:"filled",children:l.message})})]})}export{$ as default};
