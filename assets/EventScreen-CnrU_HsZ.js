import{r as d,j as e}from"./index-FEUtmEKI.js";import{a as b}from"./index-xsH4HHeE.js";import{A as J,T as K,a as Q,b as V,c as T,d as s,e as X,E as Y,D as Z,f as ee,g as te,h as ae,i as re}from"./Delete-DrQDpEZt.js";import{C as se,B,a as $,T as y,F as ne,I as oe,S as le,b as ie}from"./TextField-BXXwOkAV.js";import{T as de,C as O,A as F,P as ce,I as M}from"./List-BNTYkXwl.js";import{C as ue}from"./listItemTextClasses-D7QzGMO1.js";import{M as A}from"./MenuItem-D4XVO5ZL.js";import"./Transition-CllzQJyI.js";import"./TransitionGroupContext-QBMk-fzG.js";const me="http://localhost:3000",C=`${me}/events`,L=a=>{if(!a)return"";try{const l=new Date(a),x=l.getTimezoneOffset()*6e4;return new Date(l.getTime()-x).toISOString().slice(0,16)}catch(l){return console.error("Error formatting date for input:",a,l),""}},P=a=>{if(!a)return"N/A";try{return new Date(a).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(l){return console.error("Error formatting date for display:",a,l),"Invalid Date"}},he=a=>{switch(a==null?void 0:a.toLowerCase()){case"confirmado":return"success";case"pendente":return"warning";case"cancelado":return"error";default:return"default"}},N={id:null,name:"",start_date:"",end_date:"",local:"",status:"Pendente"};function Ie(){const[a,l]=d.useState([]),[x,I]=d.useState(!0),[S,h]=d.useState(null),[v,g]=d.useState({open:!1,message:"",severity:"info"}),[H,E]=d.useState(!1),[f,z]=d.useState(!1),[n,D]=d.useState(N),[i,_]=d.useState(!1),w=d.useCallback(async(t=!0)=>{var o,c;t&&I(!0),h(null);try{const r=await b.get(C,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}});l(Array.isArray(r.data)?r.data:[])}catch(r){console.error("Failed to load events:",r);const u=((c=(o=r.response)==null?void 0:o.data)==null?void 0:c.message)||r.message||"Could not fetch events.";h(u),l([])}finally{t&&I(!1)}},[]);d.useEffect(()=>{w()},[w]);const W=(t,o)=>{o!=="clickaway"&&g({...v,open:!1})},R=()=>{z(!1),D(N),E(!0),h(null)},q=t=>{z(!0),D({...t,start_date:L(t.start_date),end_date:L(t.end_date)}),E(!0),h(null)},k=()=>{i||E(!1)},p=t=>{const{name:o,value:c}=t.target;D(r=>({...r,[o]:c}))},U=async()=>{var o,c,r;if(_(!0),h(null),!((o=n.name)!=null&&o.trim())){g({open:!0,message:"Erro: Nome do evento é obrigatório.",severity:"error"}),_(!1);return}let t={...n,start_date:n.start_date?new Date(n.start_date).toISOString():null,end_date:n.end_date?new Date(n.end_date).toISOString():null};if(!f){const{...u}=t;t=u}try{f?(await b.put(`${C}/${n.id}`,t,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),g({open:!0,message:"Evento atualizado com sucesso!",severity:"success"})):(await b.post(C,t,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),g({open:!0,message:"Evento criado com sucesso!",severity:"success"})),k(),await w(!1)}catch(u){console.error("Failed to save event:",u);const m=((r=(c=u.response)==null?void 0:c.data)==null?void 0:r.message)||`Could not ${f?"update":"create"} event.`;g({open:!0,message:`Erro: ${m}`,severity:"error"})}finally{_(!1)}},G=async t=>{var r,u;const o=a.find(m=>m.id===t),c=o?o.name:`ID ${t}`;if(window.confirm(`Tem certeza que deseja deletar o evento "${c}"? Esta ação não pode ser desfeita.`))try{await b.delete(`${C}/${t}`,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),g({open:!0,message:"Evento deletado com sucesso!",severity:"success"}),l(m=>m.filter(j=>j.id!==t))}catch(m){console.error(`Failed to delete event ${t}:`,m);const j=((u=(r=m.response)==null?void 0:r.data)==null?void 0:u.message)||"Could not delete event.";h(j),g({open:!0,message:`Erro ao deletar: ${j}`,severity:"error"})}};return e.jsxs(se,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(B,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(de,{variant:"h4",component:"h1",gutterBottom:!0,children:"Eventos"}),e.jsx($,{variant:"contained",color:"primary",startIcon:e.jsx(J,{}),onClick:R,disabled:x,children:"Novo Evento"})]}),x&&e.jsx(B,{sx:{display:"flex",justifyContent:"center",my:5},children:e.jsx(O,{})}),S&&!x&&e.jsx(F,{severity:"error",sx:{mb:3},onClose:()=>h(null),children:S}),!x&&e.jsx(ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(K,{sx:{maxHeight:650},children:e.jsxs(Q,{stickyHeader:!0,"aria-label":"sticky event table",children:[e.jsx(V,{children:e.jsxs(T,{children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"Nome"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Início"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Fim"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Local"}),e.jsx(s,{align:"center",sx:{fontWeight:"bold"},children:"Status"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:"Aões"})]})}),e.jsx(X,{children:!S&&a.length===0?e.jsx(T,{children:e.jsx(s,{colSpan:6,align:"center",sx:{py:3},children:"Nenhum evento encontrado. Crie um para começar!"})}):a.map(t=>e.jsxs(T,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",children:t.name}),e.jsx(s,{children:P(t.start_date)}),e.jsx(s,{children:P(t.end_date)}),e.jsx(s,{children:t.local}),e.jsx(s,{align:"center",children:e.jsx(ue,{label:t.status||"Desconhecido",color:he(t.status),size:"small"})}),e.jsxs(s,{align:"right",children:[e.jsx(M,{"aria-label":`editar evento ${t.name}`,size:"small",onClick:()=>q(t),sx:{mr:.5},children:e.jsx(Y,{fontSize:"small"})}),e.jsx(M,{"aria-label":`deletar evento ${t.name}`,size:"small",color:"error",onClick:()=>G(t.id),children:e.jsx(Z,{fontSize:"small"})})]})]},t.id))})]})})}),e.jsxs(ee,{open:H,onClose:k,"aria-labelledby":"event-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{id:"event-dialog-title",children:f?"Editar Evento":"Criar Novo Evento"}),e.jsxs(ae,{children:[e.jsx(y,{autoFocus:!0,margin:"dense",id:"name",name:"name",label:"Nome do Evento",type:"text",fullWidth:!0,variant:"outlined",value:n.name,onChange:p,required:!0,disabled:i}),e.jsx(y,{margin:"dense",id:"start_date",name:"start_date",label:"Data e Hora de Início",type:"datetime-local",fullWidth:!0,variant:"outlined",value:n.start_date,onChange:p,InputLabelProps:{shrink:!0},disabled:i}),e.jsx(y,{margin:"dense",id:"end_date",name:"end_date",label:"Data e Hora de Fim",type:"datetime-local",fullWidth:!0,variant:"outlined",value:n.end_date,onChange:p,InputLabelProps:{shrink:!0},disabled:i}),e.jsx(y,{margin:"dense",id:"local",name:"local",label:"Local",type:"text",fullWidth:!0,variant:"outlined",value:n.local,onChange:p,disabled:i}),e.jsxs(ne,{margin:"dense",fullWidth:!0,variant:"outlined",disabled:i,children:[e.jsx(oe,{id:"status-select-label",children:"Status"}),e.jsxs(le,{labelId:"status-select-label",id:"status",name:"status",value:n.status,onChange:p,label:"Status",children:[e.jsx(A,{value:"Pendente",children:"Pendente"}),e.jsx(A,{value:"Confirmado",children:"Confirmado"}),e.jsx(A,{value:"Cancelado",children:"Cancelado"})]})]})]}),e.jsxs(re,{sx:{px:3,pb:2},children:[" ",e.jsx($,{onClick:k,color:"secondary",disabled:i,children:"Cancelar"}),e.jsx($,{onClick:U,variant:"contained",color:"primary",disabled:i,startIcon:i?e.jsx(O,{size:20,color:"inherit"}):null,children:i?"Salvando...":f?"Salvar Alterações":"Criar Evento"})]})]}),e.jsx(ie,{open:v.open,autoHideDuration:6e3,onClose:W,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(F,{onClose:W,severity:v.severity,sx:{width:"100%"},variant:"filled",children:v.message})})]})}export{Ie as default};
