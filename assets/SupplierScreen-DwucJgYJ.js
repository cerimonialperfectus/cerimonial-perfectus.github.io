import{r as d,j as e}from"./index-FEUtmEKI.js";import{a as v}from"./index-xsH4HHeE.js";import{A as U,T as G,a as K,b as Q,c as T,d as s,e as V,E as Y,D as Z,f as ee,g as te,h as re,i as ae}from"./Delete-DrQDpEZt.js";import{C as se,B as M,a as k,T as g,F as ne,I as oe,S as le,b as ie}from"./TextField-BXXwOkAV.js";import{T as de,C as N,A as B,P as ce,I as P}from"./List-BNTYkXwl.js";import{C as ue}from"./listItemTextClasses-D7QzGMO1.js";import{M as O}from"./MenuItem-D4XVO5ZL.js";import"./Transition-CllzQJyI.js";import"./TransitionGroupContext-QBMk-fzG.js";const he="http://localhost:3000",C=`${he}/suppliers`,me=u=>{switch(u==null?void 0:u.toLowerCase()){case"ativo":return"success";case"inativo":return"error";default:return"default"}},q={id:null,name:"",cnpj:"",email:"",phone:"",address:"",status:"Ativo"};function ye(){const[u,S]=d.useState([]),[f,w]=d.useState(!0),[y,h]=d.useState(null),[j,m]=d.useState({open:!1,message:"",severity:"info"}),[D,X]=d.useState(!1),[b,W]=d.useState(!1),[n,I]=d.useState(q),[l,E]=d.useState(!1),$=d.useCallback(async(t=!0)=>{var a,o;t&&w(!0),h(null);try{const r=await v.get(C,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}});S(Array.isArray(r.data)?r.data:[])}catch(r){console.error("Failed to load suppliers:",r);const p=((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||r.message||"Could not fetch suppliers.";h(p),S([])}finally{t&&w(!1)}},[]);d.useEffect(()=>{$()},[$]);const z=(t,a)=>{a!=="clickaway"&&m({...j,open:!1})},H=()=>{W(!1),I(q),X(!0),h(null)},J=t=>{W(!0),I(t),X(!0),h(null)},F=()=>{l||X(!1)},x=t=>{const{name:a,value:o}=t.target;I(r=>({...r,[a]:o}))},L=t=>{var a,o,r;return(a=t.name)!=null&&a.trim()?(o=t.cnpj)!=null&&o.trim()?!/^\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}$/.test(t.cnpj)&&!/^\d{14}$/.test(t.cnpj)?"Formato de CNPJ inválido. Use XX.XXX.XXX/XXXX-XX ou 14 dígitos.":(r=t.email)!=null&&r.trim()?/\S+@\S+\.\S+/.test(t.email)?t.status?null:"Status é obrigatório.":"Formato de email inválido.":"Email é obrigatório.":"CNPJ é obrigatório.":"Nome do fornecedor é obrigatório."},R=async()=>{var o,r,p,c;E(!0),h(null);const t=L(n);if(t){m({open:!0,message:`Erro: ${t}`,severity:"error"}),E(!1);return}const a={name:n.name.trim(),cnpj:n.cnpj.replace(/[^\d]/g,""),email:n.email.trim(),phone:((o=n.phone)==null?void 0:o.trim())||null,address:((r=n.address)==null?void 0:r.trim())||null,status:n.status};try{const i={headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}};b?(await v.put(`${C}/${n.id}`,a,i),m({open:!0,message:"Fornecedor atualizado com sucesso!",severity:"success"})):(await v.post(C,a,i),m({open:!0,message:"Fornecedor criado com sucesso!",severity:"success"})),F(),await $(!1)}catch(i){console.error("Failed to save supplier:",i);const A=((c=(p=i.response)==null?void 0:p.data)==null?void 0:c.message)||`Could not ${b?"update":"create"} supplier.`;m({open:!0,message:`Erro: ${A}`,severity:"error"})}finally{E(!1)}},_=async t=>{var r,p;const a=u.find(c=>c.id===t),o=a?a.name:`ID ${t}`;if(window.confirm(`Tem certeza que deseja deletar o fornecedor "${o}"? Esta ação não pode ser desfeita.`))try{const c={headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}};await v.delete(`${C}/${t}`,c),m({open:!0,message:"Fornecedor deletado com sucesso!",severity:"success"}),S(i=>i.filter(A=>A.id!==t))}catch(c){console.error(`Failed to delete supplier ${t}:`,c);const i=((p=(r=c.response)==null?void 0:r.data)==null?void 0:p.message)||"Could not delete supplier.";h(i),m({open:!0,message:`Erro ao deletar: ${i}`,severity:"error"})}};return e.jsxs(se,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(de,{variant:"h4",component:"h1",gutterBottom:!0,children:"Fornecedores"}),e.jsx(k,{variant:"contained",color:"primary",startIcon:e.jsx(U,{}),onClick:H,disabled:f,children:"Novo Fornecedor"})]}),f&&e.jsx(M,{sx:{display:"flex",justifyContent:"center",my:5},children:e.jsx(N,{})}),y&&!f&&e.jsx(B,{severity:"error",sx:{mb:3},onClose:()=>h(null),children:y}),!f&&e.jsx(ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(G,{sx:{maxHeight:650},children:e.jsxs(K,{stickyHeader:!0,"aria-label":"sticky supplier table",children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"Nome"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"CNPJ"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Email"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Telefone"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Endereço"}),e.jsx(s,{align:"center",sx:{fontWeight:"bold"},children:"Status"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:"Ações"})]})}),e.jsx(V,{children:!y&&u.length===0?e.jsx(T,{children:e.jsx(s,{colSpan:6,align:"center",sx:{py:3},children:"Nenhum fornecedor encontrado. Crie um para começar!"})}):u.map(t=>e.jsxs(T,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",children:t.name}),e.jsx(s,{children:t.cnpj})," ",e.jsx(s,{children:t.email}),e.jsx(s,{children:t.phone?t.phone:"-"})," ",e.jsx(s,{children:t.address?t.address:"-"}),e.jsx(s,{align:"center",children:e.jsx(ue,{label:t.status||"Desconhecido",color:me(t.status),size:"small"})}),e.jsxs(s,{align:"right",children:[e.jsx(P,{"aria-label":`editar fornecedor ${t.name}`,size:"small",onClick:()=>J(t),sx:{mr:.5},children:e.jsx(Y,{fontSize:"small"})}),e.jsx(P,{"aria-label":`deletar fornecedor ${t.name}`,size:"small",color:"error",onClick:()=>_(t.id),children:e.jsx(Z,{fontSize:"small"})})]})]},t.id))})]})})}),e.jsxs(ee,{open:D,onClose:F,"aria-labelledby":"supplier-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{id:"supplier-dialog-title",children:b?"Editar Fornecedor":"Criar Novo Fornecedor"}),e.jsxs(re,{children:[e.jsx(g,{autoFocus:!0,margin:"dense",id:"name",name:"name",label:"Nome do Fornecedor",type:"text",fullWidth:!0,variant:"outlined",value:n.name,onChange:x,required:!0,disabled:l}),e.jsx(g,{margin:"dense",id:"cnpj",name:"cnpj",label:"CNPJ",type:"text",fullWidth:!0,variant:"outlined",value:n.cnpj,onChange:x,required:!0,disabled:l,placeholder:"XX.XXX.XXX/XXXX-XX"}),e.jsx(g,{margin:"dense",id:"email",name:"email",label:"Email",type:"email",fullWidth:!0,variant:"outlined",value:n.email,onChange:x,required:!0,disabled:l}),e.jsxs(ne,{margin:"dense",fullWidth:!0,variant:"outlined",required:!0,disabled:l,children:[e.jsx(oe,{id:"status-select-label",children:"Status"}),e.jsxs(le,{labelId:"status-select-label",id:"status",name:"status",value:n.status,onChange:x,label:"Status",children:[e.jsx(O,{value:"Ativo",children:"Ativo"}),e.jsx(O,{value:"Inativo",children:"Inativo"})]})]}),e.jsx(g,{margin:"dense",id:"phone",name:"phone",label:"Telefone (Opcional)",type:"tel",fullWidth:!0,variant:"outlined",value:n.phone,onChange:x,disabled:l,placeholder:"(XX) XXXXX-XXXX"}),e.jsx(g,{margin:"dense",id:"address",name:"address",label:"Endereço (Opcional)",type:"text",fullWidth:!0,variant:"outlined",value:n.address,onChange:x,disabled:l,multiline:!0,rows:2})]}),e.jsxs(ae,{sx:{px:3,pb:2},children:[e.jsx(k,{onClick:F,color:"secondary",disabled:l,children:"Cancelar"}),e.jsx(k,{onClick:R,variant:"contained",color:"primary",disabled:l,startIcon:l?e.jsx(N,{size:20,color:"inherit"}):null,children:l?"Salvando...":b?"Salvar Alterações":"Criar Fornecedor"})]})]}),e.jsx(ie,{open:j.open,autoHideDuration:6e3,onClose:z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(B,{onClose:z,severity:j.severity,sx:{width:"100%"},variant:"filled",children:j.message})})]})}export{ye as default};
