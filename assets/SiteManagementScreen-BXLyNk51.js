import{r as y,j as t}from"./index-FEUtmEKI.js";import{a as R}from"./index-xsH4HHeE.js";import{A as Z,T as fe,a as he,b as xe,c as K,d as I,e as ye,E as Se,D as ee,f as be,g as je,h as ve,i as Ce}from"./Delete-DrQDpEZt.js";import{p as Ie,q as $e,d as le,i as we,e as ce,a as de,v as ke,s as ue,u as me,w as Ae,g as ze,T as B,n as Q,m as Ee,k as Te,C as te,A as se,P as Ge,I as ne}from"./List-BNTYkXwl.js";import{s as Me,u as Pe,c as Ne,d as Re,C as We,B as W,a as M,T as V,b as De}from"./TextField-BXXwOkAV.js";import"./TransitionGroupContext-QBMk-fzG.js";import"./Transition-CllzQJyI.js";const Be=(e,s)=>e.filter(n=>s.includes(n)),E=(e,s,n)=>{const o=e.keys[0];Array.isArray(s)?s.forEach((i,r)=>{n((u,f)=>{r<=e.keys.length-1&&(r===0?Object.assign(u,f):u[e.up(e.keys[r])]=f)},i)}):s&&typeof s=="object"?(Object.keys(s).length>e.keys.length?e.keys:Be(e.keys,Object.keys(s))).forEach(r=>{if(e.keys.includes(r)){const u=s[r];u!==void 0&&n((f,j)=>{o===r?Object.assign(f,j):f[e.up(r)]=j},u)}}):(typeof s=="number"||typeof s=="string")&&n((i,r)=>{Object.assign(i,r)},s)};function O(e){return`--Grid-${e}Spacing`}function L(e){return`--Grid-parent-${e}Spacing`}const re="--Grid-columns",z="--Grid-parent-columns",Oe=({theme:e,ownerState:s})=>{const n={};return E(e.breakpoints,s.size,(o,i)=>{let r={};i==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(r={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${z}) - (var(${z}) - ${i}) * (var(${L("column")}) / var(${z})))`}),o(n,r)}),n},Le=({theme:e,ownerState:s})=>{const n={};return E(e.breakpoints,s.offset,(o,i)=>{let r={};i==="auto"&&(r={marginLeft:"auto"}),typeof i=="number"&&(r={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${z}) + var(${L("column")}) * ${i} / var(${z}))`}),o(n,r)}),n},Fe=({theme:e,ownerState:s})=>{if(!s.container)return{};const n={[re]:12};return E(e.breakpoints,s.columns,(o,i)=>{const r=i??12;o(n,{[re]:r,"> *":{[z]:r}})}),n},_e=({theme:e,ownerState:s})=>{if(!s.container)return{};const n={};return E(e.breakpoints,s.rowSpacing,(o,i)=>{var u;const r=typeof i=="string"?i:(u=e.spacing)==null?void 0:u.call(e,i);o(n,{[O("row")]:r,"> *":{[L("row")]:r}})}),n},He=({theme:e,ownerState:s})=>{if(!s.container)return{};const n={};return E(e.breakpoints,s.columnSpacing,(o,i)=>{var u;const r=typeof i=="string"?i:(u=e.spacing)==null?void 0:u.call(e,i);o(n,{[O("column")]:r,"> *":{[L("column")]:r}})}),n},Ue=({theme:e,ownerState:s})=>{if(!s.container)return{};const n={};return E(e.breakpoints,s.direction,(o,i)=>{o(n,{flexDirection:i})}),n},qe=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:`var(${O("row")}) var(${O("column")})`}}),Ke=e=>{const s=[];return Object.entries(e).forEach(([n,o])=>{o!==!1&&o!==void 0&&s.push(`grid-${n}-${String(o)}`)}),s},Ve=(e,s="xs")=>{function n(o){return o===void 0?!1:typeof o=="string"&&!Number.isNaN(Number(o))||typeof o=="number"&&o>0}if(n(e))return[`spacing-${s}-${String(e)}`];if(typeof e=="object"&&!Array.isArray(e)){const o=[];return Object.entries(e).forEach(([i,r])=>{n(r)&&o.push(`spacing-${i}-${String(r)}`)}),o}return[]},Je=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([s,n])=>`direction-${s}-${n}`):[`direction-xs-${String(e)}`];function Qe(e,s){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,s.keys.forEach(n=>{e[n]!==void 0&&delete e[n]})}const Xe=ke(),Ye=Me("div",{name:"MuiGrid",slot:"Root"});function Ze(e){return Pe({props:e,name:"MuiGrid",defaultTheme:Xe})}function et(e={}){const{createStyledComponent:s=Ye,useThemeProps:n=Ze,useTheme:o=Ie,componentName:i="MuiGrid"}=e,r=(x,m)=>{const{container:b,direction:c,spacing:p,wrap:l,size:v}=x,w={root:["root",b&&"container",l!=="wrap"&&`wrap-xs-${String(l)}`,...Je(c),...Ke(v),...b?Ve(p,m.breakpoints.keys[0]):[]]};return ce(w,k=>de(i,k),{})};function u(x,m,b=()=>!0){const c={};return x===null||(Array.isArray(x)?x.forEach((p,l)=>{p!==null&&b(p)&&m.keys[l]&&(c[m.keys[l]]=p)}):typeof x=="object"?Object.keys(x).forEach(p=>{const l=x[p];l!=null&&b(l)&&(c[p]=l)}):c[m.keys[0]]=x),c}const f=s(Fe,He,_e,Oe,Ue,qe,Le),j=y.forwardRef(function(m,b){const c=o(),p=n(m),l=$e(p);Qe(l,c.breakpoints);const{className:v,children:w,columns:k=12,container:P=!1,component:F="div",direction:T="row",wrap:N="wrap",size:_={},offset:H={},spacing:G=0,rowSpacing:U=G,columnSpacing:q=G,unstable_level:a=0,...d}=l,g=u(_,c.breakpoints,$=>$!==!1),h=u(H,c.breakpoints),S=m.columns??(a?void 0:k),C=m.spacing??(a?void 0:G),A=m.rowSpacing??m.spacing??(a?void 0:U),ge=m.columnSpacing??m.spacing??(a?void 0:q),X={...l,level:a,columns:S,container:P,direction:T,wrap:N,spacing:C,rowSpacing:A,columnSpacing:ge,size:g,offset:h},pe=r(X,c);return t.jsx(f,{ref:b,as:F,ownerState:X,className:le(pe.root,v),...d,children:y.Children.map(w,$=>{var Y;return y.isValidElement($)&&we($,["Grid"])&&P&&$.props.container?y.cloneElement($,{unstable_level:((Y=$.props)==null?void 0:Y.unstable_level)??a+1}):$})})});return j.muiName="Grid",j}const J=et({createStyledComponent:ue("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.container&&s.container]}}),componentName:"MuiGrid",useThemeProps:e=>me({props:e,name:"MuiGrid"}),useTheme:Ae});function tt(e){return de("MuiInputAdornment",e)}const ae=ze("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var ie;const st=(e,s)=>{const{ownerState:n}=e;return[s.root,s[`position${Q(n.position)}`],n.disablePointerEvents===!0&&s.disablePointerEvents,s[n.variant]]},nt=e=>{const{classes:s,disablePointerEvents:n,hiddenLabel:o,position:i,size:r,variant:u}=e,f={root:["root",n&&"disablePointerEvents",i&&`position${Q(i)}`,u,o&&"hiddenLabel",r&&`size${Q(r)}`]};return ce(f,tt,s)},rt=ue("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:st})(Ee(({theme:e})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(e.vars||e).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${ae.positionStart}&:not(.${ae.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),at=y.forwardRef(function(s,n){const o=me({props:s,name:"MuiInputAdornment"}),{children:i,className:r,component:u="div",disablePointerEvents:f=!1,disableTypography:j=!1,position:x,variant:m,...b}=o,c=Ne()||{};let p=m;m&&c.variant,c&&!p&&(p=c.variant);const l={...o,hiddenLabel:c.hiddenLabel,size:c.size,disablePointerEvents:f,position:x,variant:p},v=nt(l);return t.jsx(Re.Provider,{value:null,children:t.jsx(rt,{as:u,ownerState:l,className:le(v.root,r),ref:n,...b,children:typeof i=="string"&&!j?t.jsx(B,{color:"textSecondary",children:i}):t.jsxs(y.Fragment,{children:[x==="start"?ie||(ie=t.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,i]})})})}),it=Te(t.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),ot="http://localhost:3000",D=`${ot}/siteManagement`,oe={id:null,title:"",description:"",images:[""]};function ft(){const[e,s]=y.useState([]),[n,o]=y.useState(!0),[i,r]=y.useState(null),[u,f]=y.useState({open:!1,message:"",severity:"info"}),[j,x]=y.useState(!1),[m,b]=y.useState(!1),[c,p]=y.useState(oe),[l,v]=y.useState(!1),w=y.useCallback(async(a=!0)=>{var d,g;a&&o(!0),r(null);try{const h=await R.get(D,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}});s(Array.isArray(h.data)?h.data:[])}catch(h){const S=((g=(d=h.response)==null?void 0:d.data)==null?void 0:g.message)||h.message||"Não foi possível carregar as seções.";r(S),s([])}finally{a&&o(!1)}},[]);y.useEffect(()=>{w()},[w]);const k=(a,d)=>{d!=="clickaway"&&f({...u,open:!1})},P=()=>{b(!1),p(oe),x(!0),r(null)},F=a=>{b(!0),p({...a,images:Array.isArray(a.images)&&a.images.length>0?a.images:[""]}),x(!0),r(null)},T=()=>{l||x(!1)},N=a=>{const{name:d,value:g}=a.target;p(h=>({...h,[d]:g}))},_=(a,d)=>{p(g=>{const h=[...g.images];return h[a]=d,{...g,images:h}})},H=()=>{p(a=>({...a,images:[...a.images,""]}))},G=a=>{p(d=>{const g=d.images.filter((h,S)=>S!==a);return{...d,images:g.length>0?g:[""]}})},U=async()=>{var d,g,h;if(v(!0),r(null),!((d=c.title)!=null&&d.trim())){f({open:!0,message:"Erro: Título é obrigatório.",severity:"error"}),v(!1);return}let a={...c,images:c.images.filter(S=>S.trim()!=="")};if(!m){const{...S}=a;a=S}try{m?(await R.put(`${D}/${c.id}`,a,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),f({open:!0,message:"Seção atualizada com sucesso!",severity:"success"})):(await R.post(D,a,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),f({open:!0,message:"Seção criada com sucesso!",severity:"success"})),T(),await w(!1)}catch(S){const C=((h=(g=S.response)==null?void 0:g.data)==null?void 0:h.message)||`Não foi possível ${m?"atualizar":"criar"} a seção.`;f({open:!0,message:`Erro: ${C}`,severity:"error"})}finally{v(!1)}},q=async a=>{var h,S;const d=e.find(C=>C.id===a),g=d?d.title:`ID ${a}`;if(window.confirm(`Tem certeza que deseja deletar a seção "${g}"? Esta ação não pode ser desfeita.`))try{await R.delete(`${D}/${a}`,{headers:{userId:localStorage.getItem("userId"),Authorization:`Bearer ${localStorage.getItem("token")}`}}),f({open:!0,message:"Seção deletada com sucesso!",severity:"success"}),s(C=>C.filter(A=>A.id!==a))}catch(C){const A=((S=(h=C.response)==null?void 0:h.data)==null?void 0:S.message)||"Não foi possível deletar a seção.";r(A),f({open:!0,message:`Erro ao deletar: ${A}`,severity:"error"})}};return t.jsxs(We,{maxWidth:"lg",sx:{mt:4,mb:4},children:[t.jsxs(W,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Seções do Site"}),t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(Z,{}),onClick:P,disabled:n,children:"Nova Seção"})]}),n&&t.jsx(W,{sx:{display:"flex",justifyContent:"center",my:5},children:t.jsx(te,{})}),i&&!n&&t.jsx(se,{severity:"error",sx:{mb:3},onClose:()=>r(null),children:i}),!n&&t.jsx(Ge,{sx:{width:"100%",overflow:"hidden"},children:t.jsx(fe,{sx:{maxHeight:650},children:t.jsxs(he,{stickyHeader:!0,"aria-label":"sticky section table",children:[t.jsx(xe,{children:t.jsxs(K,{children:[t.jsx(I,{sx:{fontWeight:"bold"},children:"Título"}),t.jsx(I,{sx:{fontWeight:"bold"},children:"Descrição"}),t.jsx(I,{sx:{fontWeight:"bold"},children:"Imagens"}),t.jsx(I,{align:"right",sx:{fontWeight:"bold"},children:"Ações"})]})}),t.jsx(ye,{children:!i&&e.length===0?t.jsx(K,{children:t.jsx(I,{colSpan:4,align:"center",sx:{py:3},children:"Nenhuma seção cadastrada. Crie uma para começar!"})}):e.map(a=>t.jsxs(K,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[t.jsx(I,{component:"th",scope:"row",children:a.title}),t.jsx(I,{children:t.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-line"},children:a.description})}),t.jsx(I,{children:t.jsx(W,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:(a.images||[]).map((d,g)=>d?t.jsx("img",{src:d,alt:`img-${g}`,style:{width:48,height:48,objectFit:"cover",borderRadius:4,border:"1px solid #eee"}},g):null)})}),t.jsxs(I,{align:"right",children:[t.jsx(ne,{"aria-label":`editar seção ${a.title}`,size:"small",onClick:()=>F(a),sx:{mr:.5},children:t.jsx(Se,{fontSize:"small"})}),t.jsx(ne,{"aria-label":`deletar seção ${a.title}`,size:"small",color:"error",onClick:()=>q(a.id),children:t.jsx(ee,{fontSize:"small"})})]})]},a.id))})]})})}),t.jsxs(be,{open:j,onClose:T,"aria-labelledby":"section-dialog-title",maxWidth:"sm",fullWidth:!0,children:[t.jsx(je,{id:"section-dialog-title",children:m?"Editar Seção":"Criar Nova Seção"}),t.jsxs(ve,{children:[t.jsx(V,{autoFocus:!0,margin:"dense",id:"title",name:"title",label:"Título",type:"text",fullWidth:!0,variant:"outlined",value:c.title,onChange:N,required:!0,disabled:l}),t.jsx(V,{margin:"dense",id:"description",name:"description",label:"Descrição",type:"text",fullWidth:!0,multiline:!0,minRows:3,variant:"outlined",value:c.description,onChange:N,disabled:l}),t.jsx(B,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Imagens (URLs)"}),t.jsxs(J,{container:!0,spacing:1,children:[c.images.map((a,d)=>t.jsx(J,{item:!0,xs:12,children:t.jsxs(W,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(V,{label:`Imagem ${d+1}`,value:a,onChange:g=>_(d,g.target.value),fullWidth:!0,margin:"dense",disabled:l,InputProps:{startAdornment:t.jsx(at,{position:"start",children:t.jsx(it,{fontSize:"small"})})}}),t.jsx(M,{onClick:()=>G(d),color:"error",sx:{ml:1,minWidth:0},disabled:l||c.images.length===1,children:t.jsx(ee,{fontSize:"small"})})]})},d)),t.jsx(J,{item:!0,xs:12,children:t.jsx(M,{onClick:H,startIcon:t.jsx(Z,{}),size:"small",disabled:l,children:"Adicionar Imagem"})})]})]}),t.jsxs(Ce,{sx:{px:3,pb:2},children:[t.jsx(M,{onClick:T,color:"secondary",disabled:l,children:"Cancelar"}),t.jsx(M,{onClick:U,variant:"contained",color:"primary",disabled:l,startIcon:l?t.jsx(te,{size:20,color:"inherit"}):null,children:l?"Salvando...":m?"Salvar Alterações":"Criar Seção"})]})]}),t.jsx(De,{open:u.open,autoHideDuration:6e3,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(se,{onClose:k,severity:u.severity,sx:{width:"100%"},variant:"filled",children:u.message})})]})}export{ft as default};
